# Java Backend hackathon

## Команда: Nuclear Cats

 - Корначук Марк Всеволодович
 - Лукичев Артемий Николаевич

### Ошибка
Ошибка возникает из-за того, что в базу данных пытаются
записаться две строки с одинаковыми ключами. Это происходит
из-за того, что запросы принимаются и обрабатываются 
несколькими потоками. Из-за этого проверка на то, что 
id, который мы пытаемся записать, нет, срабатывает некорректно:
несколько потоков одновременно запускают данную проверку и
получают разрешение на запись. Однако база данных не позволяет
создать несколько строк с одинаковым id из-за чего только первый
поток выполняет код корректно, а все остальные выдают ошибку.
Так же было обнаружено, что запросы собираются в очередь, 
после чего параллельно обрабатываются по несколько штук
в один и тот же момент.

### Исправление
Исправить данную ошибку можно путем синхронизации потоков в момент
вызова функции записи так, чтобы не возникало параллельных
вызовов. Для этого стоит использовать ключевое слово
`synchronized`, позволяющее выполнять функцию, к которой
оно применено, в одном потоке.

Так же можно уменьшить количество приемников до одного, но
этот вариант не так хорош как первый.

Была идея использовать декоратор `@Transactional`, однако,
оказалось, что он не синхронизирует потоки и может произойти,
та же ошибка. Возможна ситуация при которой меняются сразу
несколько строк и проверяются несколько строк, что вызовет
ошибку даже на уровне изоляции `REPEATABLE_READ`. 
Значит следует использовать уровень изоляции `SERIALIZABLE`,
что фактически соответствует ключевому слову synchronized.

Таким образом, всё что нужно сделать - это добавить
ключевое слово `synchronized` методу
`saveHackathonEntity` в классе DomainServiceImpl.

```java
    @Override
    public synchronized void saveHackathonEntity(SendingDto sendingDto) {
        if (!hackathonEntityRepository.existsHackathonEntityByName(sendingDto.getName())) {
            hackathonEntityRepository.save(new HackathonEntity(sendingDto.getName()));
        }
    }
```


